---
output: md_document
always_allow_html: yes
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```


```{r, include=FALSE}
# you'll need to delete the eval=FALSE for this code chunk to execute
# but keep the include = FALSE so that it does not show up in the knit file (on the webpage)

library(tidyverse)
#library(phantomjs)
library(lubridate)
library(ical)
library(htmlwidgets)
library(plotly)
library(streamgraph)
library(viridis)
library(plyr)
library(ggcorrplot)
library(hrbrthemes)

my_calendar <- ical_parse_df(file = "Data_Science_Project.ics") %>%
  mutate(start_datetime = with_tz(start, tzone = "America/New_York")
    , end_datetime = with_tz(end, tzone = "America/New_York")
    , length_min = end_datetime - start_datetime
    , length_sec = length_min*60
    , length_hrs = length_min/60
    , date = floor_date(start_datetime, unit = "day")) %>%
  # modifying faulty data entries/inconsistencies
  select(summary, description, start_datetime, end_datetime, length_sec, length_min, length_hrs, date) %>%
  mutate(description = ifelse(description == '', NA, as.character(description))) %>%
  mutate(description = ifelse(description == '\nSchool', 'School', description)) %>%
  mutate(description = ifelse(description == 'Exercise\nFamily', 'Exercise Family', description)) %>%
  mutate(description = ifelse(summary == 'Dinner', 'Family', ifelse(summary == 'Sleep', 'Sleep', description))) %>%
  mutate(description = ifelse(is.na(description) & summary != "Cole's Birthday", 'School', description)) %>%
  mutate(description = ifelse(summary == "Walking", 'Exercise Family', description))
```

```{r, include=FALSE}
# start of data wrangling section

school_wrangled <- my_calendar %>%
  filter(description == 'School') %>%
  separate(summary, into=c('class', 'activity'), sep=': ', remove=FALSE) %>%
  mutate(activity = ifelse(class %in% c('Data Science', 'Evolutionary', 'Groups', 'Abnormal', 'Work'), activity, class)) %>%
  mutate(class = ifelse(class %in% c('Data Science', 'Evolutionary', 'Groups', 'Abnormal', 'Work'), class, NA)) %>%
  mutate(class = ifelse(activity == 'Fellows Meeting', 'Work', class))

#reorder columns for binding
school_wrangled <- school_wrangled[,c(10, 1, 2, 3:9)]

my_calendar1 <- my_calendar %>%
  mutate(class = NA, activity = summary) %>%
  filter(description != 'School')

# reorder columns for binding
my_calendar1 <- my_calendar1[,c(1, 9:10, 2:8)]

# binds dfs together and seperates "Exercise and Family" into Exercise and Family
# enables activities to count in both activities, user decision
my_calendar_summary_modified <- my_calendar1 %>%
  rbind(school_wrangled) %>%
  separate(description, into=c('description1', 'description2'), sep=" ") %>%
  gather(key=k, value=description, c('description1', 'description2')) %>%
  drop_na(description) %>%
  arrange(start_datetime) %>%
  select(-k)

# rearrange columns as desired
my_calendar_summary_modified <- my_calendar_summary_modified[,c(1:3, 10, 4:9)]

# check to see that only descriptions are school, family, sleep, social
unique(my_calendar_summary_modified$description)

#write_csv(my_calendar_summary_modified, '~/Dropbox (Personal)/git/calendar-project/my_calendar_summary.csv')
```

# Purpose of this Website

COVID-19 was an extremely tumultuous time for everyone, with most people experiencing disruptions to their daily lives and routines. I wanted to quantify the difference in routine that I experienced while transitioning from Amherst College to home. To best express this difference, I have created an interactive Shiny app that displays how my routine has changed and have analyzed the big trends that I noted.

# Motivating Questions

My primary questions of interest were the following:

- What classes did I spent the most time in during quarantine?
- Is my productivity related to my sleep patterns and, if so, how?
- What time of day am I the most productive? In other words, what time of day do I do the most work?
- How has the total time spent across broad categories that define my daily routine (school, exercise, social, family) changed over time? How has the amount of time I spend in each class changed over time?
- What is the distribution of the amount of time I spent in each category?

My hope was that I could glean some insights from this data about how I structure my time when I am in a less structured environment (Amherst College), where I had more explicitly scheduled activities and priorities.

And, to brighten the mood during these somber times, here's a picture of a cute puppy:

![cute puppy](./img/cute_puppy.png)

## Data collection

I collected data by recording all of the activities that I did over the course of two weeks. I made no intentions of doing these activities at these particular times; data was entered retroactively since the primary objective was to figure out how I structured my time with less explicit structure to my routine.

I explicitly recorded my data into 5 unique classes:

1. Data Science
2. Evolutionary (Computation, a CS class I was taking at the time)
3. Groups (Rings and Fields, ie Abstract Algebra)
4. Abnormal (Psychology)
5. Work (classified as any activity that was school-related but not under the particular umbrella of a class)

I also tracked each category's "description" as one of the following:

1. Sleep (was asleep)
2. School (one of the five classes)
3. Exercise
4. Family
5. Social (eg. Zoom meetings with friends, Netflix party, ...)

I also included the particular activity that I was doing. I decided not to include activities in my Shiny app simply because most activities had unique identifiers (eg, Groups HW9 would be different from Groups Study for Quiz) so it would be difficult to interactively look at how I distributed my time by activity. I also felt that was not the objective of my study; however, this is certainly a future direction to look into.

Each activity had a time stamp (beginning and ending time) and times are recorded in PST.

# Results

I made a Shiny app to display my results. Images relevant to the analysis will be screenshotted and included here, but the link to access the Shiny app is below. Git unfortunately does not allow for shiny apps to be embedded in-page, so please do click the link to open the app.

New line added as test.

[Link to Shiny app: Diary of a Wimpy Bakshandeh](https://michaelbakshandeh.shinyapps.io/calendar-project/)

## Total Time spent in Classes over Time

The graph below is presented in my Shiny app, but is reproduced here for ease of access:

```{r, echo=FALSE}

# manipulations on my_calendar_summary_modified
final_form_streamgraph <- my_calendar_summary_modified %>%
  filter(!is.na(class)) %>%
  select(-c('length_min', 'length_sec')) %>%
  group_by(class, date) %>%
  select(starts_with('length_')) %>%
  summarise_all(funs('total'=sum)) %>%
  mutate(date = as.Date(date))

# graphs barplot
p <- ggplot(final_form_streamgraph, aes_string(x='date', y='total', fill='class')) +
      geom_col(position='dodge') +
      scale_x_date(date_breaks='1 day', date_labels = '%a %b %d') +
      scale_fill_viridis(discrete = TRUE, alpha=0.6, option='D') +
      theme_ipsum() +
      labs(
        x = 'Date',
        y = 'Total Time in Hours',
        title = 'Time Spent on Particular Classes \nAnd Job-Related Endeavors'
      ) +
      theme(axis.text.x = element_text(angle = 90, hjust = 1))
    # ggplot(formatted_data(), aes(x=date))
      
ggplotly(p) %>%
  htmlwidgets::saveWidget("classes_bar_graph.html")
```

[classes bar graph](classes_bar_graph.html)

I've also included the streamgraph here for an alternative visual:

```{r, echo=FALSE}
# displays the streamgraph
pp <- streamgraph(final_form_streamgraph, key="class", value="total", date="date", interpolate='cardinal', 
                      order='inside-out') %>%
      sg_fill_brewer('Pastel2') %>%
      sg_axis_x(1, tick_interval='day', tick_format = '%a %b %d')

pp %>% htmlwidgets::saveWidget('classes_streamgraph.html')
```

[streamgraph visual1](classes_streamgraph.html)

From the streamgraph, it appears that the I do the most work on Mondays and Tuesdays, and the amount of total work that I do decreases as the week progresses. On Mondays and Tuesdays in particular, there appears to be a spike in the amount of work I do in my "Work" class. This is likely because I am a TA for Multivariable Calculus, so I am logging in "Work" on these days that doesn't exist on any other day.

Furthermore, as affirmed by the bar chart and the streamgraph, the class that is the most "time consuming" for me is definitely Groups. There appears to be spikes in the amount of work I do in Groups on Wednesdays and Thursdays (for instance, on Wednesday April 8th I worked on Groups for 4.5 hours). This is likely because we have weekly quizzes in Groups on Thursdays and weekly homeworks due on Thursdays (at 10pm), so I spend some time on Wednesday working through the concepts to prepare for the quiz.

My other classes (Data Science, Evolutionary, and Abnromal) appear not too time-consuming in comparison. There is a spike in the amount of work I did in Evolutionary on Monday, April 13th, and there is also a spike in the amount of work I did in Data Science one week later. Abnromal overall appears to be the least time consuming, since it takes up the least amount of area in the streamgraph.

## Distribution of Categories





